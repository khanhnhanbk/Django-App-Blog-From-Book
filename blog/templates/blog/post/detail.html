{% extends 'blog/base.html' %}
{% load blog_tags %}

{% block title %}
  {{ block.super }} | {{ post.title }}
{% endblock %}

{% block content %}
  <!-- Image Section -->
  <div class="bg-image hover-overlay" data-mdb-ripple-init data-mdb-ripple-color="light">
    <img src="https://picsum.photos/1200/400?random={{ post.id }}" class="img-fluid w-100 rounded" alt="{{ post.title }}" />
    <div class="mask" style="background-color: rgba(0, 0, 0, 0.3);"></div>
  </div>

  <!-- Content Section -->
  <div class="container mt-5">
    <div class="row">
      <div class="col-lg-8 mx-auto">
        <article>
          <header class="mb-4">
            <h1 class="fw-bolder mb-1">{{ post.title }}</h1>
            <div class="text-muted fst-italic mb-2">
              Published on {{ post.publish }} by {{ post.author }}
            </div>
            {% if post.tags.all %}
              <div class="mb-3">
                {% for tag in post.tags.all %}
                  <a href="{% url 'blog:post_list_by_tag' tag.slug %}" class="badge bg-secondary text-decoration-none">{{ tag.name }}</a>
                {% endfor %}
              </div>
            {% endif %}
          </header>
          
          <figure class="mb-4">
            <img class="img-fluid rounded" src="https://picsum.photos/seed/{{ post.id }}/900/400" alt="{{ post.title }}">
          </figure>
          
          <section class="mb-5">
            {{ post.content|markdown }}
          </section>
        </article>

        <section class="mb-5">
          <div class="card bg-light">
            <div class="card-body">
              <h2 class="card-title">Share this post</h2>
              <a href="{% url 'blog:post_share' post.id %}" class="btn btn-primary">Email</a>
            </div>
          </div>
        </section>

        <section class="mb-5">
          <div class="card bg-light">
            <div class="card-body">
              <h2 class="card-title">Comments</h2>
              {% with comments.count as total_comments %}
                <h3 class="mb-3">
                  {{ total_comments }} comment{{ total_comments|pluralize }}
                </h3>
              {% endwith %}
              {% for comment in comments %}
                <div class="mb-3 p-3 border rounded">
                  <p class="mb-1"><strong>{{ comment.name }}</strong></p>
                  <p class="mb-1">{{ comment.body|linebreaks }}</p>
                  <p class="text-muted"><small>Comment {{ forloop.counter }} / {{ comments.count }}</small></p>
                </div>
              {% empty %}
                <p>There are no comments yet.</p>
              {% endfor %}
              {% if new_comment %}
                <h2>Your comment has been added.</h2>
              {% else %}
                <h2>Add a new comment</h2>
                <form method="post">
                  {{ comment_form|crispy }}
                  {% csrf_token %}
                  <button type="submit" class="btn btn-primary mt-3">Add comment</button>
                </form>
              {% endif %}
            </div>
          </div>
        </section>

        {% if similar_posts %}
          <section>
            <h2>Similar posts</h2>
            {% for post in similar_posts %}
              <div class="mb-3">
                <h3><a href="{{ post.get_absolute_url }}">{{ post.title }}</a></h3>
                <p class="text-muted">Published {{ post.publish }} by {{ post.author }}</p>
              </div>
            {% endfor %}
          </section>
        {% endif %}
      </div>
    </div>
  </div>
{% endblock %}
